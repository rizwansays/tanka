!function(t){"use strict";const i={on_ready:function(){i.cache(),i.add_listeners()},cache:function(){i.post_id=t("#post_ID").val(),t("#orderable_multi_location_store_services_meta_box").length?i.$metabox=t("#orderable_multi_location_store_services_meta_box"):i.$metabox=t("#orderable_location_store_services_meta_box"),i.$modal_wrapper=t("#orderable-delivery-zones-modal-wrapper"),i.$modal_add_update=t("#orderable-delivery-zones-modal-add-update"),i.$modal_add_existing=t("#orderable-delivery-zones-modal-add-existing"),i.msg_timeout=null,i.modal_transition_time_slot_id=null,i.add_existing_modal_opened=!1},add_listeners:function(){i.$modal_wrapper.on("click",".js-delivery-zones-tab-nav-link",i.handler_toggle_tabs),i.$modal_wrapper.on("click","#js-cancel-delivery-zone-modal",i.handler_close_modal),i.$modal_wrapper.on("click","#js-add-new-delivery-zone",i.handler_add_update_zone),i.$modal_wrapper.on("click","#js-add-existing-delivery-zone",i.handler_add_existing_zone),i.$modal_wrapper.on("click","#js-transition-existing-to-new-modal",i.handler_transition_modal),i.$modal_wrapper.on("change",".js-delivery-zones-list-item input",i.handler_mark_zone_selected),i.$modal_wrapper.on("keyup","#js-delivery-zone-search",i.handler_zone_search),i.$modal_wrapper.on("change keyup",i.handler_modal_form_change),i.$metabox.on("click",".js-open-add-delivery-zone-modal",i.handler_open_add_update_modal),i.$metabox.on("click",".js-add-existing-delivery-zone",i.handler_open_add_existing_modal),i.$metabox.on("click",".js-remove-delivery-zone",i.handler_remove_zone),t(document.body).on("orderable-remove-row",i.handler_remove_all_time_slot_zones),t(document).on("keyup","#js-delivery-zone-modal-fee",i.handler_sanitize_fee),t(document).on("keyup",i.handler_escape_key_close_modal),t(document).on("orderable-delivery-zone-ajax-success",i.handler_trigger_dom_update),t(document).on("orderable-delivery-zone-after-dom-update",i.handler_after_dom_update)},handler_trigger_dom_update:function(e,{request_data:o,response_data:a}){if(o.request_type)switch(o.request_type){case"edit":i.update_delivery_zone_in_time_slot(o,a);break;case"add_new":case"add_existing":i.insert_delivery_zone_in_time_slot(o,a);break;case"remove":i.remove_delivery_zone_in_time_slot(o,a);break;case"delete":i.remove_delivery_zone_in_list_table(o,a)}},handler_after_dom_update:function(e,a){setTimeout(function(){var e,o;"add_new"===a.request.request_type&&(e=wp.template("existing-zones-list-item"),o=i.generate_zone_row_data(a.request,a.response,a.time_slot_row),t("#js-delivery-zone-modal-zones-list").append(e(o))),i.close_modal()},250)},handler_toggle_tabs:function(e){},handler_escape_key_close_modal:function(e){"Escape"==e.key&&i.handler_close_modal()},handler_open_add_update_modal:function(e,o){let a;var d="add-new"===(a=o||(t(e.target).hasClass("dashicons")?t(e.target).parent():t(e.target)).data("action"))?window.orderable_dz_js_vars.text.modal_add:window.orderable_dz_js_vars.text.modal_update,o=o?i.modal_transition_time_slot_id:i.get_time_slot_id(e),r=i.get_time_slot_index(e);i.$modal_add_update.find(".orderable-delivery-zones-modal__title").text(d),i.$modal_add_update.find(".orderable-delivery-zones-modal__button--add-update .text").text(d),i.$modal_add_update.find(".js-delivery-zone-modal-time-slot").val(o),i.$modal_add_update.find(".js-delivery-zone-modal-time-slot-index").val(r),"edit"===a&&i.form_add_zone_data(e),setTimeout(function(){t("body").css({"overflow-y":"hidden"}),i.$modal_wrapper.show(),i.$modal_add_update.fadeIn()},250)},handler_open_add_existing_modal:function(e){var o=i.get_time_slot_id(e),a=i.get_time_slot_index(e);i.$modal_add_existing.find(".js-delivery-zone-modal-time-slot").val(o),i.$modal_add_existing.find(".js-delivery-zone-modal-time-slot-index").val(a),i.hide_existing_time_slot_zones(e),setTimeout(function(){t("body").css({"overflow-y":"hidden"}),i.$modal_wrapper.show(),i.$modal_add_existing.fadeIn(),i.maybe_show_no_zones_msg()},100)},handler_close_modal:function(e){i.close_modal(e)},handler_add_update_zone:function(e){i.maybe_show_modal_spinner();var o=t("#js-delivery-zone-modal-zone-id").val(),a={request_type:o?"edit":"add_new",post_id:i.post_id,time_slot_index:parseInt(i.$modal_add_update.find(".js-delivery-zone-modal-time-slot-index").val()),time_slot_id:parseInt(i.$modal_add_update.find(".js-delivery-zone-modal-time-slot").val()),zone_name:t("#js-delivery-zone-modal-area-name").val(),zone_postcodes:t("#js-delivery-zone-modal-postcodes").val(),zone_fee:t("#js-delivery-zone-modal-fee").val()};o&&(a.zone_id=o),a.zone_name&&a.zone_postcodes?i.handler_trigger_dom_update(e,{request_data:a,response_data:{data:{status:!0,zone_id:o||Date.now()}}}):(a.zone_name||t("#js-delivery-zone-modal-valid-name").fadeIn(),a.zone_postcodes||t("#js-delivery-zone-modal-valid-postcodes").fadeIn(),i.maybe_show_modal_spinner())},handler_add_existing_zone:function(a){i.maybe_show_modal_spinner(),t(".orderable-delivery-zones-modal__field-checkbox:checked").each(function(e,o){o={request_type:"add_existing",post_id:i.post_id,zone_id:t(o).val(),time_slot_index:i.$modal_add_existing.find(".js-delivery-zone-modal-time-slot-index").val(),time_slot_id:i.$modal_add_existing.find(".js-delivery-zone-modal-time-slot").val(),zone_name:t(o).data("zone-name"),zone_postcodes:t(o).data("zone-postcodes"),zone_fee:t(o).data("zone-fee")};i.handler_trigger_dom_update(a,{request_data:o,response_data:{data:{status:!0,zone_id:o.zone_id}}})}),i.close_modal()},handler_transition_modal:function(e){i.modal_transition_time_slot_id=t(e.target).closest(".orderable-delivery-zones-modal__form").find(".js-delivery-zone-modal-time-slot").val(),i.close_modal(e,!0)},handler_remove_zone:function(e){var o,a;window.confirm(window.orderable_dz_js_vars.text.zone_confirm_remove)&&(o=i.get_time_slot_id(e),a=i.get_zone_id(e),i.handler_trigger_dom_update(e,{request_data:{request_type:"remove",zone_id:a,time_slot_id:o},response_data:{data:{status:!0,zone_ids:[a]}}}))},handler_remove_all_time_slot_zones:function(e,o){const a=t(o.trigger_element).closest(".orderable-table__row"),d=a.data("orderable-time-slot"),r=a.find(".orderable-table-delivery-zones-row__item"),l=[];r.each(function(e,o){l.push(t(o).data("zone-id"))}),i.handler_trigger_dom_update(e,{request_data:{request_type:"remove",zone_ids:l,time_slot_id:d},response_data:{data:{status:!0,zone_ids:l,msg:"All delivery zones successfully removed!"}}})},handler_sanitize_fee:function(e){t(e.target).val(t(e.target).val().replace(/[^0-9.]/gm,""))},handler_zone_search:function(e){const o=t(".orderable-delivery-zones-modal-add-existing .orderable-delivery-zones-modal__zones-list-item:not(.hide-existing)"),r=t(e.target).val().toLowerCase();o.length?(clearTimeout(void 0),setTimeout(function(){!r||r.length<2?o.show():o.each(function(e,o){var a=t(o),d=a.find("input[type=checkbox]").data("zone-name").toLowerCase();a.hasClass("hide-existing")||!d.includes(r)?t(o).hide():t(o).show()}),i.maybe_show_no_zones_msg()},100)):i.maybe_show_no_zones_msg()},handler_modal_form_change:function(e){var o=t("#js-add-new-delivery-zone"),a=t("#js-add-existing-delivery-zone");t("#js-delivery-zone-modal-postcodes").val()&&t("#js-delivery-zone-modal-area-name").val()?o.prop("disabled",!1):o.prop("disabled",!0),t(".orderable-delivery-zones-modal__zones-list-item.selected").length?a.prop("disabled",!1):a.prop("disabled",!0)},handler_mark_zone_selected:function(e){e=t(e.target).closest(".orderable-delivery-zones-modal__zones-list-item");e.hasClass("selected")?e.removeClass("selected"):e.addClass("selected")},maybe_show_no_zones_msg:function(){var e=t(".orderable-delivery-zones-modal-add-existing .orderable-delivery-zones-modal__zones-list-item:not(.hide-existing):visible"),o=t("#js-no-delivery-zones-msg"),a=t(".orderable-delivery-zones-modal__button--add-existing");e.length?(i.add_existing_modal_opened&&(a.prop("disabled",!1),i.add_existing_modal_opened=!0),o.hide()):(a.prop("disabled",!0),o.show())},generate_zone_row_data:function(e,o,a=!1){let d=null;o=e.zone_id||o.data.zone_id,a.length&&(d="edit"===e.request_type?a.find(`.orderable-table-delivery-zones-row__item[data-zone-id=${o}]`).data("zone-count"):a.find(".orderable-table-delivery-zones-row__item").length+1),a={time_slot_id:e.time_slot_id,zone_id:o,zone_name:e.zone_name,zone_postcodes:e.zone_postcodes,zone_fee:e.zone_fee};return{...a,input_value:JSON.stringify(a),delivery_zone_id:d,time_slot_index:e.time_slot_index,text_zone_title:window.orderable_dz_js_vars.text.zone_title,text_edit_zone:window.orderable_dz_js_vars.text.zone_edit,text_remove_zone:window.orderable_dz_js_vars.text.zone_remove}},insert_delivery_zone_in_time_slot:function(e,o){var a=t(`.orderable-toggle-wrapper--delivery [data-orderable-index=${e.time_slot_index}]`),d=wp.template("delivery-zones-row"),r=i.generate_zone_row_data(e,o,a),d=(a.find(".orderable-table-delivery-zones-row__no-items").hide(),a.find(".orderable-table-delivery-zones-row__actions").before(d(r)),o.data.status?"success":"error");t(document).trigger("orderable-delivery-zone-after-dom-update",{status:d,request:e,response:o,time_slot_row:a})},update_delivery_zone_in_time_slot:function(e,o){var a,d,r,l;e.time_slot_id&&(a=t(`.orderable-toggle-wrapper--delivery [data-orderable-time-slot=${e.time_slot_id}]`),d=wp.template("delivery-zones-row"),r=i.generate_zone_row_data(e,o,a),l=e.zone_id||o.data.zone_id,a.find(`.orderable-table-delivery-zones-row__item[data-zone-id=${l}]`).replaceWith(d(r)),t(document).trigger("orderable-delivery-zone-after-dom-update",{status:"success",request:e,response:o}))},remove_delivery_zone_in_time_slot:function(e,o){for(var a of o.data.zone_ids)t(`.orderable-toggle-wrapper--delivery [data-orderable-time-slot=${e.time_slot_id}] .orderable-table-delivery-zones-row__item[data-zone-id=${a}]`).remove();var d=t(`.orderable-toggle-wrapper--delivery [data-orderable-time-slot=${e.time_slot_id}]`);d.find(".orderable-table-delivery-zones-row__item").length||d.find(".orderable-table-delivery-zones-row__no-items").fadeIn(),t(document).trigger("orderable-delivery-zone-after-dom-update",{status:o.success,request:e,response:o}),i.reset_modal_forms()},form_add_zone_data:function(e){e=t(e.target).closest("[data-zone-id]");t("#js-delivery-zone-modal-zone-id").val(e.attr("data-zone-id")),t("#js-delivery-zone-modal-postcodes").val(e.attr("data-zone-postcodes")),t("#js-delivery-zone-modal-area-name").val(e.attr("data-zone-name")),t("#js-delivery-zone-modal-fee").val(e.attr("data-zone-fee")),t("#js-delivery-zone-modal-postcodes").val()&&t("#js-delivery-zone-modal-area-name").val()&&t("#js-add-new-delivery-zone").prop("disabled",!1)},close_modal:function(e,o=!1){setTimeout(function(){t("body").css({"overflow-y":"visible"}),o||i.$modal_wrapper.fadeOut(),i.$modal_wrapper.find(".orderable-delivery-zones-modal").hide(),t(".orderable-delivery-zones-modal__msg").fadeOut(),i.maybe_show_modal_spinner(!0),i.unhide_existing_time_slot_zones(),i.reset_modal_forms(),i.add_existing_modal_opened=!1,t(".orderable-delivery-zones-modal__footer .orderable-delivery-zones-modal__button--add-update").prop("disabled",!0),t(".orderable-delivery-zones-modal__footer .orderable-delivery-zones-modal__button--add-existing").prop("disabled",!0),o&&i.handler_open_add_update_modal(e,"add-new")},250)},reset_modal_forms:function(){i.$modal_wrapper.find('input:not([type="checkbox"]), textarea').val(""),i.$modal_wrapper.find('input[type="checkbox"]').removeAttr("checked"),i.$modal_wrapper.find(".orderable-delivery-zones-modal__zones-list-item").removeClass("selected").fadeIn()},maybe_show_modal_spinner:function(e=!1){var o=t(".orderable-delivery-zones-modal__button .icon");e||o.hasClass("active")?o.removeClass("active"):o.addClass("active")},hide_existing_time_slot_zones:function(e){const o=i.get_time_slot_id(e),d=t(`.orderable-toggle-wrapper--delivery [data-orderable-time-slot=${o}]`),a=t(".orderable-delivery-zones-modal__zones-list-item");d.length&&a.each(function(e,o){var a=t(o).find("input").val();a&&d.find(`.orderable-table-delivery-zones-row__item[data-zone-id="${a}"]`).length&&t(o).addClass("hide-existing")})},unhide_existing_time_slot_zones:function(){t(".orderable-delivery-zones-modal__zones-list-item").removeClass("hide-existing")},get_time_slot_id:function(e){return parseInt(t(e.target).closest(".orderable-table__row").data("orderable-time-slot"))},get_time_slot_index:function(e){return parseInt(t(e.target).closest(".orderable-table__row").data("orderable-index"))},get_zone_id:function(e){return t(e.target).closest(".orderable-table-delivery-zones-row__item").data("zone-id")}};t(document).ready(i.on_ready)}(jQuery),function(a){var o={on_ready:function(){a(".orderable-toggle-field").on("click",o.handle_toggle_field_on_click),a(".orderable-override-open-hours-toggle-field").on("click",o.handle_override_open_hours_on_click),a(".orderable-delivery-toggle-field").on("click",o.handle_enable_service_delivery_on_click),a(".orderable-pickup-toggle-field").on("click",o.handle_enable_service_pickup_on_click),a(".orderable-admin-button--pickup").on("click",function(){a("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked")?a(".orderable-element--pickup").addClass("orderable-element--disabled"):a(".orderable-element--pickup").removeClass("orderable-element--disabled")});var e=a(".datepicker").data("datepicker");a(".datepicker").datepicker(e),a(document.body).on("orderable-new-row",o.on_new_holiday_row)},handle_toggle_field_on_click:function(){a(this).toggleClass(["woocommerce-input-toggle--disabled","woocommerce-input-toggle--enabled"]);var e=a(this).hasClass("woocommerce-input-toggle--enabled");a(this).siblings(".orderable-toggle-field__input").val(e?"yes":"no")},handle_override_open_hours_on_click:function(){a(this).siblings(".orderable-open-hours-settings").toggleClass("orderable-store-open-hours--hide"),a(".orderable-store-open-hours__open-hours").toggleClass("orderable-store-open-hours--hide")},handle_enable_service_delivery_on_click:function(){var e=a(this).hasClass("woocommerce-input-toggle--enabled");pickup_is_enabled="yes"===a("[name=orderable_location_store_services_pickup]").val(),e?(a(".orderable-admin-button--delivery").removeClass("orderable-ui-hide"),a(".orderable-notice--select-service").addClass("orderable-ui-hide")):a(".orderable-admin-button--delivery").addClass("orderable-ui-hide").removeClass("orderable-trigger-element--active"),pickup_is_enabled&&e?(a("#orderable_location_service_hours_pickup_same_as_delivery_label").removeClass("orderable-ui-hide"),a(".orderable-toggle-wrapper--pickup").find(".orderable-select--days").first().val().length||a("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked",!0).change()):e&&!pickup_is_enabled?(a("#orderable_location_service_hours_pickup_same_as_delivery_label").removeClass("orderable-ui-hide"),a(".orderable-admin-button--delivery").addClass("orderable-trigger-element--active"),a(".orderable-toggle-wrapper--delivery").addClass("orderable-toggle-wrapper--active")):e||pickup_is_enabled?!e&&pickup_is_enabled&&(a("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked",!1).change(),a("#orderable_location_service_hours_pickup_same_as_delivery_label").addClass("orderable-ui-hide"),a(".orderable-table--service-hours-pickup").removeClass("orderable-element--disabled"),a(".orderable-admin-button--pickup").addClass("orderable-trigger-element--active"),a(".orderable-toggle-wrapper--pickup").addClass("orderable-toggle-wrapper--active").removeClass("orderable-element--disabled"),a(".orderable-admin-button--delivery").removeClass("orderable-trigger-element--active"),a(".orderable-toggle-wrapper--delivery").removeClass("orderable-toggle-wrapper--active")):(a(".orderable-notice--select-service").removeClass("orderable-ui-hide"),a(".orderable-toggle-wrapper--delivery").removeClass("orderable-toggle-wrapper--active"))},handle_enable_service_pickup_on_click:function(){var e=a(this).hasClass("woocommerce-input-toggle--enabled"),o="yes"===a("[name=orderable_location_store_services_delivery]").val();e?(a(".orderable-admin-button--pickup").removeClass("orderable-ui-hide"),a(".orderable-table--service-hours-pickup").removeClass("orderable-element--disabled"),a(".orderable-notice--select-service").addClass("orderable-ui-hide")):a(".orderable-admin-button--pickup").addClass("orderable-ui-hide").removeClass("orderable-trigger-element--active"),e&&o?(a("#orderable_location_service_hours_pickup_same_as_delivery_label").removeClass("orderable-ui-hide"),a("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked",!0).change()):e&&!o?(a("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked",!1).change(),a("#orderable_location_service_hours_pickup_same_as_delivery_label").addClass("orderable-ui-hide"),a(".orderable-admin-button--pickup").addClass("orderable-trigger-element--active"),a(".orderable-toggle-wrapper--pickup").addClass("orderable-toggle-wrapper--active").removeClass("orderable-element--disabled"),a(".orderable-element--pickup").removeClass("orderable-element--disabled")):!e&&o?(a("#orderable_location_service_hours_pickup_same_as_delivery").prop("checked",!0).change(),a("#orderable_location_service_hours_pickup_same_as_delivery_label").addClass("orderable-ui-hide"),a(".orderable-table--service-hours-delivery").removeClass("orderable-element--disabled"),a(".orderable-admin-button--delivery").addClass("orderable-trigger-element--active"),a(".orderable-toggle-wrapper--delivery").addClass("orderable-toggle-wrapper--active").removeClass("orderable-element--disabled"),a(".orderable-admin-button--pickup").removeClass("orderable-trigger-element--active"),a(".orderable-toggle-wrapper--pickup").removeClass("orderable-toggle-wrapper--active")):o||e||(a(".orderable-notice--select-service").removeClass("orderable-ui-hide"),a(".orderable-toggle-wrapper--pickup").removeClass("orderable-toggle-wrapper--active"))},on_new_holiday_row:function(){a(".orderable-table--holidays").find(".orderable-table__row--repeatable:last-child").find(".datepicker").each(function(){var e=a(this).data("datepicker");a(this).datepicker(e)})}};a(document).ready(o.on_ready)}(jQuery);